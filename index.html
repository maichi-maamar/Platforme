<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Plateforme Chauffeur Yassir Premium</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<style>
/* Arri√®re‚Äëplan image full page */
body {
    margin: 0;
    font-family: 'Poppins', sans-serif;
    background: url('IMG_20260223_103833.jpg') no-repeat center center fixed;
    background-size: cover;
    color: white;
}

/* Container principal */
.container {
    max-width: 550px;
    margin: auto;
    padding: 25px;
}

/* Carte chauffeur */
.card {
    background: rgba(255,255,255,0.12);
    backdrop-filter: blur(20px);
    border-radius: 25px;
    padding: 25px;
    margin-bottom: 30px;
    box-shadow: 0 15px 50px rgba(0,0,0,0.6);
}

.status {
    display: inline-block;
    margin-top: 10px;
    padding: 6px 15px;
    border-radius: 50px;
    background: #00ff9d;
    color: black;
    font-size: 12px;
    font-weight: bold;
}

/* Titres de sections */
.section-title {
    margin: 20px 0 10px;
    font-size: 18px;
    font-weight: 600;
    text-align: center;
}

/* Grille publicit√©s */
.promo-grid {
    display: grid;
    gap: 20px;
}

/* Pub individuelle */
.promo-item {
    position: relative;
    border-radius: 15px;
    overflow: hidden;
    cursor: pointer;
}

/* Bouton localisation */
.loc-btn {
    position: absolute;
    top: 12px;
    right: 12px;
    background: #00ff9d;
    color: black;
    padding: 8px 14px;
    border-radius: 30px;
    font-size: 12px;
    font-weight: bold;
    text-decoration: none;
    z-index: 2;
}

.promo-item img {
    width: 100%;
    display: block;
    border-radius: 15px;
}
</style>

</head>
<body>

<div class="container">

    <!-- PROFIL CHAUFFEUR -->
    <div class="card">
        <h2 id="driverName">Chargement chauffeur...</h2>
        <p>ID : <span id="driverId"></span></p>
        <div class="status" id="driverStatus"></div>
    </div>

    <!-- PUBLICIT√âS GOLD -->
    <div class="section-title">Offres GOLD</div>
    <div class="promo-grid" id="goldAds"></div>

    <!-- PUBLICIT√âS SILVER -->
    <div class="section-title">Offres SILVER</div>
    <div class="promo-grid" id="silverAds"></div>

    <!-- PUBLICIT√âS BRONZE -->
    <div class="section-title">Offres BRONZE</div>
    <div class="promo-grid" id="bronzeAds"></div>

  <div class="section-title">Offres BRONZE</div>
<div class="promo-grid" id="bronzeAds"></div>

<!-- SECTION POMPES -->
<div class="section-title">‚õΩ Pompes Conventionn√©es</div>

<button onclick="findNearestPump()" style="
padding:15px;
border-radius:30px;
background:#00ff9d;
border:none;
font-weight:bold;
width:100%;
margin-bottom:20px;
cursor:pointer;">
üöó Trouver la pompe la plus proche
</button>
  
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
<script>

// ‚öôÔ∏è Google Sheet ID
const SHEET_ID = "1QD2yljHw-O2ijbhqDgqShKlEnSEFYWz6oRzUb4ENO8Q"; // ‚Üê Remplace TON_ID par l‚ÄôID de ton Google Sheet
const sheetBase = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=`;

// üí° Lire ID depuis URL
const params = new URLSearchParams(window.location.search);
const driverId = params.get("id");

// üìå Charger CSV depuis Google Sheets
function loadCSV(sheetName, callback){
    Papa.parse(sheetBase + sheetName, {
        download: true,
        header: true,
        complete: results => callback(results.data)
    });
}

// üßç‚Äç‚ôÇÔ∏è Charger chauffeurs
loadCSV("chauffeurs", chauffeurs => {
    const driver = chauffeurs.find(c => c.id === driverId);
    if(driver){
        document.getElementById("driverName").innerText = driver.nom + " " + driver.prenom;
        document.getElementById("driverStatus").innerText = driver.statut;
        document.getElementById("driverId").innerText = driver.id;
    } else {
        document.getElementById("driverName").innerText = "Chauffeur non trouv√©";
        document.getElementById("driverStatus").innerText = "";
    }
});

// üì∏ Afficher Gold/Silver/Bronze
function showAds(sheet, elementId){
    loadCSV(sheet, data => {
        const container = document.getElementById(elementId);
        data.forEach(ad => {
            const promo = document.createElement("div");
            promo.className = "promo-item";
            promo.innerHTML = `
                <a href="${ad.localisation}" class="loc-btn" target="_blank">üìç Localiser</a>
                <a href="${ad.lien_boutique}" target="_blank">
                    <img src="${ad.image_URL}" alt="${ad.nom}">
                </a>
            `;
            container.appendChild(promo);
        });
    });
}

showAds("publicites_gold","goldAds");
showAds("publicites_silver","silverAds");
showAds("publicites_bronze","bronzeAds");


// ===== POMPES CONVENTIONN√âES =====

let pumpsData = [];

loadCSV("pompes_conventionnees", data => {
    pumpsData = data;
});

function getDistance(lat1, lon1, lat2, lon2) {
    const R = 6371;
    const dLat = (lat2 - lat1) * Math.PI / 180;
    const dLon = (lon2 - lon1) * Math.PI / 180;
    const a =
        Math.sin(dLat/2) * Math.sin(dLat/2) +
        Math.cos(lat1 * Math.PI / 180) *
        Math.cos(lat2 * Math.PI / 180) *
        Math.sin(dLon/2) * Math.sin(dLon/2);
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    return R * c;
}

function findNearestPump() {

    if (!navigator.geolocation) {
        alert("La g√©olocalisation n'est pas support√©e.");
        return;
    }

    navigator.geolocation.getCurrentPosition(position => {

        const userLat = position.coords.latitude;
        const userLon = position.coords.longitude;

        let nearest = null;
        let minDistance = Infinity;

        pumpsData.forEach(pump => {

            const distance = getDistance(
                userLat,
                userLon,
                parseFloat(pump.latitude),
                parseFloat(pump.longitude)
            );

            if (distance < minDistance) {
                minDistance = distance;
                nearest = pump;
            }
        });

        if (nearest) {
            const mapsUrl = `https://www.google.com/maps/dir/?api=1&destination=${nearest.latitude},${nearest.longitude}`;
            window.open(mapsUrl, "_blank");
        }

    }, error => {
        alert("Activez la localisation pour trouver la pompe la plus proche.");
    });
    }
    
</script>

    
</body>
</html>
